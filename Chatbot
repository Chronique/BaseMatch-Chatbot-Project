<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Aman</title>
    <!-- Memuat Tailwind CSS untuk styling yang responsif dan cantik -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary-blue': '#3B82F6',
                        'bg-light': '#F9FAFB',
                        'chat-user': '#D1FAE5',
                        'chat-bot': '#E5E7EB',
                    }
                }
            }
        }
    </script>
    <style>
        /* Gaya kustom untuk memastikan tata letak yang baik pada semua perangkat */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f2f5;
        }
        #chat-container {
            max-width: 500px;
            width: 100%;
            display: flex;
            flex-direction: column;
            height: 80vh; /* Tinggi yang baik untuk tampilan obrolan */
        }
        #messages-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            border-bottom: 1px solid #E5E7EB;
            scroll-behavior: smooth;
        }
        /* Style untuk animasi pesan terblokir */
        .blocked-message-animation {
            background-color: #FEE2E2 !important; /* Merah Muda */
            animation: shake 0.5s;
        }
        @keyframes shake {
            0% { transform: translateX(0); }
            20% { transform: translateX(-10px); }
            40% { transform: translateX(10px); }
            60% { transform: translateX(-10px); }
            80% { transform: translateX(10px); }
            100% { transform: translateX(0); }
        }

        /* Styling untuk Typing Indicator (titik-titik animasi) */
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            margin: 0 1px;
            background-color: #9CA3AF;
            border-radius: 50%;
            opacity: 0;
            animation: bounce 1.4s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
    </style>
</head>
<body class="font-sans bg-bg-light">

    <div id="chat-container" class="bg-white rounded-xl shadow-2xl overflow-hidden m-4">
        <!-- Header -->
        <header class="bg-primary-blue text-white p-4 text-center rounded-t-xl shadow-md">
            <h1 class="text-xl font-bold">Bot Obrolan Aman üîí</h1>
            <p class="text-sm opacity-90">3-Lapis Keamanan: Kata Kasar, URL, & Nomor Panjang diblokir otomatis.</p>
        </header>

        <!-- Pesan Obrolan -->
        <div id="messages-container">
            <!-- Pesan Sambutan dari Bot -->
            <div class="flex justify-start mb-4">
                <div class="bg-chat-bot p-3 rounded-xl rounded-bl-none shadow-md max-w-xs md:max-w-md">
                    <p class="text-sm text-gray-800">Halo! Sistem keamanan sekarang sangat ketat. Mari berinteraksi dengan hormat. ü§ù</p>
                </div>
            </div>
        </div>

        <!-- Area Input -->
        <div class="p-4 bg-gray-100 border-t border-gray-200">
            <div id="error-box" class="hidden p-2 mb-2 text-sm text-red-700 bg-red-100 rounded-lg" role="alert">
                <span class="font-medium">Peringatan Keamanan:</span> Pesan diblokir karena melanggar aturan obrolan (kata kasar, URL, atau informasi sensitif).
            </div>
            <div id="typing-indicator-placeholder" class="h-6 mb-2 hidden">
                <!-- Placeholder untuk indikator mengetik -->
            </div>
            <div class="flex space-x-3">
                <input type="text" id="user-input" placeholder="Ketik pesan Anda di sini..." class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-primary-blue focus:border-primary-blue focus:outline-none transition duration-150 ease-in-out">
                <button id="send-button" class="bg-primary-blue hover:bg-blue-600 text-white font-semibold py-3 px-5 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-105">
                    Kirim
                </button>
            </div>
        </div>
    </div>

    <script>
        const input = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const messagesContainer = document.getElementById('messages-container');
        const errorBox = document.getElementById('error-box');
        const typingIndicatorPlaceholder = document.getElementById('typing-indicator-placeholder');

        // Daftar Kata-kata Kasar/Terlarang (Contoh)
        const badWords = [
            // Bahasa Indonesia
            'kontol', 'memek', 'anjing', 'babi', 'jancok', 'asu', 'goblog', 'tolol', 'sialan', 'sampah', 'setan',
            // Bahasa Inggris
            'fuck', 'shit', 'asshole', 'bitch', 'cunt', 'pussy', 'dick', 'motherfucker', 'damn', 'hell',
        ];

        // Pola 1: Mendeteksi URL/Domain
        const urlPattern = new RegExp(
            `\\b(http|https|www|\\.com|\\.net|\\.org|\\.co|\\.id|\\.my|\\.sg|\\.uk)\\b`, 
            'i' // Case-insensitive
        );

        // Pola 2 (LEBIH KETAT): Mendeteksi urutan 8 digit atau lebih
        const strictPhonePattern = /(?:\d[\s\.\-\(\)]*){8,}/; 

        // Fungsi untuk memeriksa kata-kata tidak pantas
        function isProfane(message) {
            const lowerCaseMsg = message.toLowerCase();
            for (const word of badWords) {
                const pattern = new RegExp(`\\b${word}\\b`, 'i'); 
                if (pattern.test(lowerCaseMsg)) {
                    return true;
                }
            }
            return false;
        }

        // Fungsi untuk menambahkan pesan ke container
        function addMessage(sender, message, isTypingIndicator = false) {
            const messageElement = document.createElement('div');
            const bubble = document.createElement('div');

            const cleanedMessage = message.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            
            bubble.classList.add('p-3', 'rounded-xl', 'shadow-md', 'max-w-xs', 'md:max-w-md');
            
            if (isTypingIndicator) {
                bubble.classList.add('typing-indicator', 'flex', 'items-center', 'space-x-1');
                bubble.innerHTML = '<span></span><span></span><span></span>';
            } else {
                bubble.innerHTML = `<p class="text-sm text-gray-800">${cleanedMessage}</p>`;
            }


            if (sender === 'user') {
                messageElement.classList.add('flex', 'justify-end', 'mb-4');
                bubble.classList.add('bg-chat-user', 'rounded-br-none');
            } else { // bot atau indikator
                messageElement.classList.add('flex', 'justify-start', 'mb-4');
                bubble.classList.add('bg-chat-bot', 'rounded-bl-none');
            }

            messageElement.appendChild(bubble);
            messagesContainer.appendChild(messageElement);

            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            return bubble; 
        }

        // Fungsi untuk meniru respons bot yang lebih cerdas
        function getBotResponse(userMessage) {
            const lowerCaseMsg = userMessage.toLowerCase();

            if (lowerCaseMsg.includes('halo') || lowerCaseMsg.includes('hai')) {
                return 'Halo juga! Senang ngobrol dengan Anda. üëã';
            } else if (lowerCaseMsg.includes('cuaca')) {
                return 'Saya tidak bisa mengecek cuaca saat ini ‚òÅÔ∏è, tetapi saya harap hari Anda cerah! ‚òÄÔ∏è';
            } else if (lowerCaseMsg.includes('nama')) {
                return 'Saya hanya sebuah model bahasa. Anda bisa memanggil saya Bot Aman! üòâ';
            } else if (lowerCaseMsg.includes('terima kasih') || lowerCaseMsg.includes('makasih')) {
                return 'Sama-sama! Selalu siap membantu. Ada lagi yang bisa saya bantu?';
            } else if (lowerCaseMsg.includes('kopi') || lowerCaseMsg.includes('teh')) {
                return 'Ah, minuman favorit! Sayangnya, saya hanya minum kode. ‚òï';
            } else if (lowerCaseMsg.includes('base') || lowerCaseMsg.includes('blockchain')) {
                return 'Blockchain Base? Itu tempat yang bagus untuk membangun. Masa depan Web3! ‚öõÔ∏è';
            } else if (lowerCaseMsg.includes('meme')) {
                return 'Meme? Saya suka Doge. Sangat *wow*. üê∂';
            } else if (lowerCaseMsg.includes('coding') || lowerCaseMsg.includes('javascript')) {
                return 'JavaScript adalah bahasa yang menyenangkan! Saya dibuat dengan JS. Apa proyek Anda saat ini?';
            } else {
                return 'Itu topik yang menarik. Ceritakan lebih banyak tentang itu. Saya hanya bisa merespons sederhana. üôÇ';
            }
        }

        // Fungsi utama untuk mengirim pesan
        async function sendMessage() {
            const userMessage = input.value.trim();
            if (userMessage === '') return;

            input.value = '';
            errorBox.classList.add('hidden');

            let isBlocked = false;
            let blockReason = 'informasi sensitif';

            if (isProfane(userMessage)) {
                isBlocked = true;
                blockReason = 'kata-kata tidak pantas';
            } 
            else if (urlPattern.test(userMessage) || strictPhonePattern.test(userMessage)) {
                isBlocked = true;
                blockReason = 'URL atau Nomor HP/Angka Panjang';
            }

            if (isBlocked) {
                const blockedBubble = addMessage('user', userMessage);
                blockedBubble.classList.add('blocked-message-animation');

                errorBox.classList.remove('hidden');

                setTimeout(() => {
                    blockedBubble.innerHTML = `<p class="text-sm font-semibold text-red-800">Pesan Ditolak: ${blockReason} terdeteksi. üö´</p>`;
                    blockedBubble.classList.remove('bg-chat-user');
                    blockedBubble.classList.add('bg-red-200');
                    blockedBubble.classList.remove('blocked-message-animation');
                }, 500);
                return;
            }

            addMessage('user', userMessage);

            const typingIndicator = addMessage('bot', '', true);
            typingIndicatorPlaceholder.appendChild(typingIndicator.parentElement);
            typingIndicatorPlaceholder.classList.remove('hidden');

            setTimeout(() => {
                typingIndicator.parentElement.remove();
                typingIndicatorPlaceholder.classList.add('hidden');

                const botResponse = getBotResponse(userMessage);
                addMessage('bot', botResponse);
            }, 1200); 
        }

        // Event Listeners Chat
        sendButton.addEventListener('click', sendMessage);
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
